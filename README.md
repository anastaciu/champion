ISEC/DEIS –LEI / LEI-PL / LEI-ECS –Sistemas Operativos 20/21–Trabalho prático1/11Instituto Superior de Engenharia de CoimbraDepartamento de Engenharia Informática e de SistemasSistemas Operativos 20/21Trabalho Prático -Programação em C para UNIXO  trabalho  prático  de  sistemas  operativos  consiste  na  implementação  de  um  sistema  de  gestão  de campeonatos de jogosdenominado CHAMPION. Os jogos envolvidos são muito simples e não são o alvo direto  do  trabalho.  O  sistema pretendido  encarrega-se  de  fazer  a  ponte  entre  os  jogadores  e  os  jogos, mediando as mensagens trocadas entre ambos e gerindo o campeonato. Os detalhes precisos são dados mais adiante.O  trabalho  prático  deve  ser concretizadoem  linguagem  C,  para plataforma Unix  (Linux),  usando  os mecanismos   do   sistema operativo abordados   nas   aulas   teóricas   e   práticas. No   que   respeita   à manipulação  de  recursos  do sistema  deve  ser  dada  prioridade  ao  uso  de  chamadas  ao  sistema operativo1face ao uso de funções biblioteca2(por exemplo, devem ser usadas read()e write()em vez de fread()e fwrite()).  O  trabalho  foca-se  no  uso  correto  dos  mecanismos  e  recursos  do  sistema  e  não  é dada particular preferência a detalhes de escolhas na implementação de aspetos de caráter periférico à disciplina (por exemplo: a pergunta “devo usar uma lista ligada ou um arraydinâmico?” terá como resposta um encolher de ombros). O recurso a bibliotecas que façam ou ocultem parte do trabalho não é permitido. O recurso a mecanismos do sistema que não tenham sido abordados nas aulas é permitido, mas terão que ser devidamente explicados. Não é permitida uma abordagem baseada na mera colagem de excertos de outros programas ou de exemplos. Todo o código apresentado terá que ser entendido e explicado por quem o apresenta.São descritas primeiro as funcionalidades e no final as regras de funcionamento do sistema de gestão de campeonatos de jogos.1Documentadas na secção 2 das manpages2Documentadas na secção 3 das manpages
ISEC/DEIS –LEI / LEI-PL / LEI-ECS –Sistemas Operativos 20/21–Trabalho prático2/111. Descrição geralExistem  vários  jogose  vários  jogadores.Todos os  jogos  são single-player(não  existe  a  situação  de  um jogador   contra   outro)   e   todos   exibem uma   lógica   de   interação   semelhante.   Será   lançado   um campeonato que decorre durante alguns minutos. Durante ocampeonato, cada jogadorpodeinteragircom  um  jogo  apenas,  sendo-lhe  atribuída  uma  pontuaçãoquando  o  campeonato  termina.  Jogadores diferentes podem  eventualmente  estar  a  jogar  jogos  diferentes.  A  atribuição  jogador-jogo  não  é controlada pelo jogador, mas este saberá qual o jogo que lhe foi atribuído. Aspetos como dificuldadedo jogosão  perfeitamente  irrelevantes  no  trabalho,  e  se  um  jogo  for  mais  difícil  do  que  outro,  tanto  pior para o jogador a quem foi atribuído.O  objetivo  do  sistema  CHAMPION  é  mediar  a  comunicação  entre as  aplicações cliente  usadas  pelos jogadores e os jogos propriamente ditos, gerindo o campeonato e mantendo uma tabela de pontuações.2. Conceitos e entidadesO trabalho envolve os seguintes conceitos:JogooO “jogo” éum  programa  de  caracter  secundário  que  implementa  um  jogo  qualquer  cuja lógica específica não é importante. Exemplos de jogos possíveis:Adivinhar o número queo computador “pensou”(i.e., gerou aleatoriamente). Se o jogador acertar, o jogo sorteia um novo número e o jogo continua.Identificar  qual  a  tradução  em  português  de  uma  palavra  noutra  língua  (palavra sorteada de uma qualquer lista built-inao programa);Identificar o resultado de uma expressão aritmética “complicada”;Etc.oO jogo decorre com uma sequência de perguntas-respostasentre o programa e o jogador. Assim, usando o exemplo da tradução de palavras mencionado acima, seria apresentado o desafio (“Oque significa “XXXX”?”), seria recebida a resposta, a qual estaria certa ou errada, e em seguida o jogo passa à próxima pergunta (“O que significa “YYYY”?”).oA  duração  dos  jogos  é  igual  à  duração  do  campeonato:  não  existe  propriamente  um objetivo  que  ao ser  atingido  pelo  jogador  o  faria  terminar.  No  exemplo  dado  acima  de adivinhar  um  número,  se  o  jogador  acertar  e  o  campeonato  ainda  não  tiver  terminado,  o jogo sorteia outro número e o jogo continua.oHaverá  uma  pontuação,  completamente  decidida  pelo  jogo  em  questão.  No  exemplo  da tradução  de  palavras,  poderia  ser  o  número  de  traduções  certas  menos  o  número  de traduções erradas conseguidas durante o período dejogo.
ISEC/DEIS –LEI / LEI-PL / LEI-ECS –Sistemas Operativos 20/21–Trabalho prático3/11oAspetos de carácter obrigatório:O outputdo jogo (por exemplo, a “pergunta desafio”) é efetuadopeloseustdoute oinput(a resposta do jogador) é recebido noseustdin.A  pontuação obtida é  comunicada pelo  jogo  no  seu  final  através  do  seuexit status.oExistirãovários  jogos.  Os  ficheiros  executáveis  que  lhes correspondem têm  um  nome  que começa  sempre  por  “g_”.  Estes  encontram-se nadiretoria  indicada  pela  variável  de ambiente GAMEDIR. Se esta não estiver definidadeve ser assumida a diretoria atual.CampeonatooUm “campeonato”  representa  um conjunto   de   jogos   que são   jogados durante   um determinado  intervalo  de  tempo.  O  campeonato  é  aberto  a  um  número  máximo  de jogadores  em  simultâneo,  especificado  pela  variável  de  ambiente  MAXPLAYERS  e  que  se sabe  à  partida  que  nunca  será  superior  a  30.  Os  jogos  são  todos single-player.  O  jogador joga  um  e  um  só  jogo  durante  o  campeonato  (o  jogo  envolverá  várias interações com  o jogador). O jogador não escolhe o jogo–é-lhe atribuído pelo árbitro do sistema.ClienteoUm “cliente” éumprograma  usado  pelo  jogador  para  interagir  com  o árbitro  do sistema CHAMPION e, indiretamente, com o jogo. O cliente não implementa jogo nenhum: apenas recebe o inputdo jogador, encaminhando-o para o árbitro, e recebe a informação oriunda deste  último (e,indiretamente,  do  jogo),  apresentando-a  no  ecrã.O inputrecebido  do cliente pelo árbitro tanto  pode  ser informação  destinada ao  jogo que  o  jogador  esteja  a jogar como ao próprio árbitro, sendo a distinção da responsabilidade deste último.Árbitro do sistema CHAMPIONoO “Árbitro” do sistema  CHAMPION  é a  entidade  que  está  entre  o  cliente  e  os  jogos. Este programa árbitro é gerido por um administrador. O jogador não vê diretamenteo árbitro, interagindo  apenas  com  o  seu  cliente,  o  qual  interage  com  o árbitro,  o  qual por  sua  vez interage com os jogos.
ISEC/DEIS –LEI / LEI-PL / LEI-ECS –Sistemas Operativos 20/21–Trabalho prático4/11O sistema CHAMPIONcompreende os seguintes elementos:Jogadores (vários)oSão identificados por um nome e não poderá haver repetições. Não existe password.oOs  jogadores  existem  apenas  no  contextodo sistema  CHAMPION,  não  havendo qualquer relação com os utilizadores do sistemaoperativo.oNo mesmo campeonato não pode haver dois jogadores com o mesmo nome.AdministradoroEfetuaalgumas  ações  de  gestão  do campeonato.  Não  joga.  Não  tem usernameassociado nem password.  É  simplesmente  o utilizadorque  interage  com  o  processo  que  gere  o campeonato(o árbitro).O sistema CHAMPION engloba os seguintes programas:Cliente (já descrito acima)oCumprea  interface  com  o  jogador,  que  segue  o  paradigma de consola  (texto).  O  uso  de menus não é aceite. Não será necessário recorrer a qualquer composição gráfica.oCada jogador executaum cliente.ÁrbitrooGere o campeonato.oExiste  apenas  um  processo  Árbitro  a  correr  em  simultâneo  e  este  aspeto  deve  ser garantidopelo seu código.oAs suas funções incluem
ISEC/DEIS –LEI / LEI-PL / LEI-ECS –Sistemas Operativos 20/21–Trabalho prático5/11Criar os mecanismos de comunicação para:Receber  dos  clientes  pedidos  de  participação  e mensagens  destinadas aos jogos.Receber/enviar informação aos jogos.Manter   em   memória   e   gerir   os   dados   dos   utilizadores   atualmente   em campeonato, incluindo as pontuações.Interagir com o administrador e cumprir as suas instruções. Esta interação é feita segundo   o   paradigma   de   consola   (texto)   por   comandos   escritos   (nada   de “menus”).Interagir com os jogos, gerindo o seu funcionamento onde tal seja necessário.Interagir com os clientes.Gerir  o  campeonato,  garantindo  as  suas  características  operacionais  (duração, jogadores admitidos, etc.).JogosoSão  os  programas  descritos  no  início  deste  enunciado.  É  obrigatório  implementar  pelo menos  um,  diferente  dos  exemplos  citados  acima,e cujas  regras cada  grupo  tem  inteira liberdade de definir.Recomenda-se que qualquer jogo no início apresente uma mensagem de  boas  vindas  ao  utilizador  e  um  breve  sumário  suficiente  para  o  jogador  conhecer  onome  do  jogo  e  perceber  as  regras  do  mesmo.Repare  que  pode  testar o  jogo  sem  que  o sistema  CHAMPION  esteja  desenvolvido  uma  vez  que  ele  usa  a  sua stdin/stdoutpara interagir com o exterior(i.e., o jogador).3. Características operacionais de um campeonatoO campeonato fica pronto assim que o Árbitro é lançado. O programa recebe por argumento da linha de comando alguns  dados  de  configuração  e  analisa  as  variáveis  de  ambiente  GAMEDIR  e  MAXPLAYERS. Caso algo não esteja de acordo com os pressupostoso programa deverá sair de forma ordeira. O Árbitro aguarda  que  pelo  menos  dois  jogadores  estejam  prontos.  Após  dois  jogadores  já  estarem presentes, aguardará um tempo máximo por mais jogadores, findo o qual começa o campeonato.O início do campeonato envolve atribuir um jogo (escolhido pelo árbitro de forma aleatóriade entre os existentes) a  cada  jogador.  O  jogador  é  informado  de  qual  o  jogo  que  lhe foi  atribuído.  O  árbitro  é responsável  por  preparar  a  execução  dos  vários  jogos  e  encaminhar  (intermediar)  toda  a  informação entre  cliente  do  jogador  e  jogoque  lhe  foi  atribuído  nesse  campeonato.O  árbitro  mantém toda a informação  relativa  aos  jogadores,  atualizando  sempre  que  há  alterações  (novo  jogador,  alguém  saiu, recebida pontuação, etc.)
ISEC/DEIS –LEI / LEI-PL / LEI-ECS –Sistemas Operativos 20/21–Trabalho prático6/11O campeonatotem uma duração máxima. Findo este tempo:os jogos são avisados que devem terminar através de um sinal SIGUSR1;os jogos comunicam ao árbitro a pontuação do “seu” jogador através do exit status, tal como já descrito; osinal SIGUSR1 é também enviado aos clientes para osinformar que o campeonato terminou (isto não significa que os clientes devam terminar); o árbitro informará todos os clientes acerca da pontuação do seu jogador e também divulgará a identidade do jogador vencedor (i.e., que totalizou mais pontos naquele campeonato).Findo um  campeonato,  o árbitro  mantém-se  em  execução  e  o ciclo repete-se.  Os clientes  interessados em  jogar  de  novo  não  precisam  de  terminar  e  voltar  a  executar,  mas  terão  que  repetir  o  processo  de interação com o árbitro a partir do início (identificar jogador, etc.).Durante  o  campeonato  presume-se  que  a  informação  que  é  enviada  do  cliente  ao  árbitro  é  para reencaminhar  ao  jogo  que  lhe  está  atribuído. Esta  informação  é  texto,  de  acordo  com  a  lógica  de interação  com  o  jogo  tal como  descrito  atrás.  Qualquer  informação  enviada  pelo  cliente  que  seja  para consumo interno do árbitro deverá ser precedida por “#”. Encaixam-se  nesta  situação  o  pedidopara obter  a  identificação  do  jogona  forma“#mygame”(usado  pelo  utilizador  caso  já  se  tenha  esquecido, pois  essa  informação  é-lhe  dada  no  início  do  campeonato), e o  pedido  para indicar  que  desiste  do campeonato–“#quit”. Na sequência do segundo pedido ojogo atribuído a este jogador deverá também terminar. Se o campeonatoficar apenas com um jogador ativo deve terminarimediatamente, cabendo a vitória ao último jogador.Osjogos  são  atribuídos  aos  jogadores  de  forma  aleatória  e  pode  haver  dois ou  mais jogadores  a executar o mesmo jogo (mas em processos diferentes). São considerados jogos todos os programas que existem  na  diretoria  indicada  pela  variável  de  ambiente  GAMEDIR  e  que  começam  por  “g_”. O administrador poderá interferir com o processo de atribuição de jogos a jogadores.A  duração  do  campeonato  e  o  tempo  de  espera  por  mais  jogadores  para  além  dos  dois  primeiros são indicadosao árbitro por argumentos de linha de comandos aquando do seu lançamento.Sempre  que  o  árbitro  sair,  todos  os  clientes deverão  ser  informados.  Os  recursos  que  já  não  são necessários não devem permanecer em memória.
ISEC/DEIS –LEI / LEI-PL / LEI-ECS –Sistemas Operativos 20/21–Trabalho prático7/114. Formas de usoUso do clienteO cliente deveráObter a identificação do jogador.Recolher as ordens do jogador, relativas ao jogo ou outras de controlo (desistir, outras). Apresentar  os  dados  relativos  ao  decorrer  do  jogo  e  a  informação  relativa  ao inícioe  final  de um campeonato, assim como outras informações de controlo.A interaçãocom o utilizador deve ser realizada em “modo texto” por comandos escritos. Aquilo que o jogador deverá escrever é dependente da lógica do jogo que lhe calhar. Não é necessário gerir a formatação de conteúdo (posicionamento, cores, etc.).Uso do árbitroOárbitro interage apenas com o administradorsegundo a lógica de comandos escritos. Este terá à sua disposição comandos para:Listarjogadores em jogo (nome e jogo atribuído). Comando “players”Listar jogos disponíveis. Comando “games”.Remover  um  jogador do  campeonato.  O  efeito  é  o  mesmo  que  o  jogador  desistir,  mas  neste caso o cliente é informado do que aconteceu. Comando “k” concatenado com o nome do jogador(ex. “krui”–remove jogador “rui”).Suspender  a  comunicação  entre  jogador  e  jogo.  As  mensagens  deste  jogador-jogo deixam  de ser encaminhadasentre ambos. O cliente em questão é informado do que se passa. Comando “s” concatenado com o nome do jogador.Retomar  a  comunicação  entre  jogador  e  jogo.  As  mensagens  deste  jogador-jogo  voltama  ser encaminhadas. O cliente em questão é informado. Comando “r” concatenado com o nome do jogador.Encerrar   o   campeonato   imediatamente.   Tem   o   mesmo   efeito   que   ocorre   quando   o campeonato chega ao fim do seu tempo. Comando “end”.Sair, encerrando o árbitro. Comando “exit”.Podem,  opcionalmente,  serimplementados  outros  comandos  (sem valorização atribuída),  para  efeitos de  teste  e  depuração.  Por  exemplo,  um  comando  que  force  a  atribuição  de  um  jogo  específico  a  um jogador.
ISEC/DEIS –LEI / LEI-PL / LEI-ECS –Sistemas Operativos 20/21–Trabalho prático8/115. Restrições de implementaçãoNão existe comunicação diretaentre o cliente e os jogos.Só  podemser usadosos  mecanismos  de  comunicação  que  foram  abordados  nas  aulas. Pipese named pipesterão  um  papel  preponderante.  Em  momento  algum  poderá  usar  ficheiros regulares como mecanismo de comunicação entre processos.Deve precaver a validade das operações efetuadas pelos programas, de acordo com a estratégia que for implementada.  Esta  questão  decorre  das  características  da  solução  que  é  escolhida  e  não  de  algo  que seja  dito  no  enunciado.  Por  exemplo,  se  em  algum  momento  a  estratégia  seguida  necessitar de mecanismos de sincronização, então essa necessidade deve ser garantida, não podendo ser invocada a lógica “o enunciado não fala sobre isso” ou “isso é uma situação que raramente acontecerá”.Persistência de dadosNão  existe  qualquer  persistência  de  informação entre  execuções  distintas  do  árbitro,  e  o  mesmo  se aplica àsexecuções dos clientes. Não existe registo permanente de utilizadores nem de pontuações.Se  quiser,  pode  tornar  esta informação  persistente  (em  ficheiro),  mas tal  é  opcionale  sem  valorização associada.6. Considerações adicionaisToda  a ação  do  sistema  aqui  descrito  decorre  na  mesma  máquina  e  na  mesma  conta  de utilizador.  Serão  usadas  consolas/terminais  diferentes  para  cada  cliente,  mais  uma  para  o árbitro.O  cliente  tem  que  conseguir  lidar  com  várias  tarefas  em  simultâneo.  O  árbitro  também.  Deve pensar nisto.Podem  existir  diversas  situações  e  potenciais  situações  de  conflito  ou  erro  que  não  são explicitamente  mencionados  no  enunciado.  Estas  situações  devem  ser  identificadas  e  os programas  devem  lidar  com  elas  de  uma  forma  controlada  e  estável.  Um  programa  terminar abruptamente perante uma destas situações não  é considerada uma forma adequada de lidar com o cenário.Caso  se  detetem  incoerências  neste  enunciado,  as  mesmas  serão  corrigidas  e  publicadas. Poderá haver lugar a documentos adicionais no moodle, nomeadamente um Frequently Asked Questions(FAQ) com as perguntas mais frequentes e respetivas respostas.
ISEC/DEIS –LEI / LEI-PL / LEI-ECS –Sistemas Operativos 20/21–Trabalho prático9/117. Regras gerais do trabalho, METAS e DATAS IMPORTANTESAplicam-se as seguintes regras, descritas na primeira aula e na ficha da unidade curricular (FUC):O  trabalho deve ser  realizado  em  grupos  de doisalunos  (grupos  de  três  não  são  admitidos  e qualquer pedido nesse sentido será sempre negado ou ignorado).Existe defesa obrigatória. A defesa será efetuada em moldes a definir e anunciados através dos canais habituais  na  altura  em  que tal  for  relevante.A  defesa  será  presencial  exceto  se  houver ordens em contrário pela presidência da escola.Existem trêsmetas  ao  todo,  tal  como  descrito  na  FUC.  As  datas  e  requisitos  das  metas são indicados mais abaixo. Em todas as metas a entrega é feita via moodleatravés da submissão de um único arquivo zip3cujo nomerespeita o seguinte padrão4:so_2021_tp_meta1_nome1_numero1_nome2_numero2.zip(evidentemente,  meta1,  nome  e  número  serão adaptados  à  meta,  nomes  e  números dos elementos do grupo)A  não  adesão ao  formato  de  compressão  indicado  ou  ao  padrão  do  nome  do  ficheiro  será penalizada, podendo levar a que o trabalho nem seja visto.Metas: requisitos e datas de entregaMeta 1:8 deNovembroRequisitos: Planear   e   definir   as   estruturas   de   dados   responsáveis   por   gerir   as   definições   de funcionamento  no  árbitro  e  no  cliente.  Definir  os  vários header  filescom  constantes simbólicas que registem os valores por omissão comuns e específicos do cliente e servidor bem como as estruturas de dados relevantes.Obter  a“duração  do  campeonato”e  o “tempo  de  espera”, aquando da execução do árbitro, através da leitura dos argumentos de linha de comandos.Sugestão: use as funções getopt() egetsubopt().Implementar um jogo respeitando as características referidas no enunciado, exceto o que se  refere  ao  tratamento  de  sinais,  que  ainda  não  terá  que  existir.Bastará  algo  muito simples desde que siga a lógica dos jogos a usar com o sistema CHAMPION. Desenvolver  a  lógica  de  leitura  das  variáveis  de  ambiente GAMEDIR  e  MAXPLAYER  peloárbitro,  refletindo-se  nas  estruturas  de  dados  mencionadas  no  ponto  anterior.  Sugestão: usea função getenv().3Leia-se “zip” -não é arj, rar, tar, ou outros. O uso de outro formato poderá ser penalizado. Há muitos utilitários da linha de comando UNIX para lidar com estes ficheiros (zip, gzip, etc.). Use um.4O não cumprimento do formato do nome causa atrasos na gestão dos trabalhos recebidos e será penalizado.
ISEC/DEIS –LEI / LEI-PL / LEI-ECS –Sistemas Operativos 20/21–Trabalho prático10/11Desenvolver   e   entregar   um makefileque   possua   os targetsde  compilação  “all” (compilação de todos os programas), “cliente” (compilação do programa cliente), “árbitro” (compilação do programa servidor), “jogo” (compilação  do  programa jogo  proposto) e “clean” (eliminação  de  todos os ficheiros temporários  de  apoioà  compilação  e  dos executáveis).Data de entrega: Domingo,8deNovembro,2020. Sem possibilidade de entrega atrasada.Meta 2: 13deDezembroRequisitos: Acrescentar  ao  jogo  já  implementado  na  meta  1  a  parte  do  término  aquando  da  receção do sinal SIGUSR1 e a disponibilização do resultado através do exit status.Implementar toda a  lógica  de  comunicação  entre  os  clientes  e  o  árbitro  através  do mecanismo de named pipes.Implementar os comandos suportados pelo cliente: #mygamee #quit.Iniciar   o   desenvolvimento   da   leitura   de   comandos   de   administração   do   árbitro implementando  a  leitura  e  validação  dos  comandos  e  respetivos  parâmetros,  incluindo  a implementação completa doscomandosplayers, games, keexit.Data de entrega: Domingo,13deDezembro,2020. Sem possibilidade de entrega atrasada.Meta 3:24 de JaneiroRequisitos: Todos os requisitos expostos no enunciado.Data  de  entrega: Domingo,24deJaneiro,2021.  Sujeito  a  ajustes  caso  haja  alterações  no calendário escolar. Nas metas 1e 2deverá ser entregue um documento com duas páginas descrevendo os pormenores da implementação e principais opções tomadas.Na meta  3deverá  ser  entregue  um  relatório.  O  relatório  compreenderá  o  conteúdo  que  for  relevante para justificar o trabalho feito, deverá ser da exclusiva autoria dos membros do grupo. Caso venha a ser divulgado entretanto um guia de elaboração do relatório, então este deverá seguir as indicações dadas.
